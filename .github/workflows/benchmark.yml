name: Benchmark

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to run benchmarks on'
        required: true
        type: choice
        options:
          - mem/line-ending-normalization
          - mem/array-push-join
          - mem/conditional-trim
          - mem/reuse-regex
          - perf/optimize-wildcard-stopnodes
          - perf/entity-replacement-early-exit
          - perf/getallmatches-array-copy
          - perf/unpairedtags-set-optimization

jobs:
  benchmark:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ inputs.branch }}

      - name: Setup Node.js
        uses: actions/setup-node@v4

      - name: Install dependencies
        run: npm install

      - name: Install hyperfine
        run: sudo apt install -y hyperfine

      - name: Run benchmarks
        run: ./bench.sh
